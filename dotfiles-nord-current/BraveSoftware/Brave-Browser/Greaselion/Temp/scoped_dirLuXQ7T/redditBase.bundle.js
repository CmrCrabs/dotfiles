(()=>{"use strict";const e="mnojpmjdmbbfmejpflffifhffcmidifd";let t=null;const n=()=>t,r=(e,n)=>{e&&t&&t.postMessage({type:"GreaselionError",mediaType:e,data:{errorMessage:n}})},i=(e,t,n)=>{if(e.length<t.length)return"";const r=e.indexOf(t);if(-1===r)return"";const i=r+t.length,s=e.indexOf(n,i);let o="";return s!==i?o=-1!==s&&s>i||-1!==s?e.substring(i,s):e.substring(i):""===n&&(o=e.substring(i)),o},s=()=>"complete"===document.readyState&&"visible"===document.visibilityState,o="reddit",a="reddit.com",c=(e,t)=>{if(!e)return"";let n="www";return t&&(n="old"),`https://${n}.reddit.com/user/${e}/`},l=e=>{if(!e)return"";let t=i(e,'hideFromRobots":false,"id":"t2_','","isEmployee"')||i(e,'hideFromRobots":true,"id":"t2_','","isEmployee"');return t||(t=i(e,'target_fullname": "t2_','"')),t},u=e=>e?i(e,'accountIcon":"',"?"):"",d=e=>{if(!e)return"";let t=i(e,'username":"','"');return t||(t=i(e,'target_name": "','"')),t},m=()=>{const e=new URL(location.href);(e=>{if(["/","/coins","/contact","/login","/premium"].includes(e))return!0;const t=["/dev/","/help/","/r/","/wiki/"];for(const n of t)if(e.startsWith(n))return!0;return!1})(e.pathname)?(()=>{const e=`https://www.${a}`,t=a,r=a,i=n();i&&i.postMessage({type:"SavePublisherVisit",mediaType:"",data:{url:e,publisherKey:t,publisherName:r,mediaKey:"",favIconUrl:""}})})():(e=>{const t=(e=>{if(!e.pathname||!e.pathname.startsWith("/user/"))return"";const t=e.pathname.split("/").filter((e=>e));return t&&0!==t.length?t.length<2?"":t[1]:""})(e);if(!t)return void r(o,"Invalid screen name");const i=(e=>e.hostname.startsWith("old.")||e.hostname.startsWith("np."))(e);(async(e,t)=>{if(!e)throw new Error("Invalid parameters");const n=await(async(e,t)=>{if(!e)throw new Error("Invalid parameters");const n=c(e,t);if(!n)throw new Error("Invalid profile url");const r=await fetch(n);if(!r.ok){const e=((e,t)=>`Profile request failed: ${t.statusText} (${t.status})`)(0,r);throw new Error(e)}return r.text()})(e,t);return{user:{id:l(n),screenName:e,fullName:d(n),favIconUrl:u(n)},post:{id:"",timestamp:"",text:""}}})(t,i).then((e=>{const i=e.user.id,s=((e,t)=>`${e}#channel:${t}`)(o,i),a=e.user.fullName;if(!a)return void r(o,"Invalid publisher name");const l=((e,t)=>e&&t?`${e}_${t}`:"")(o,t),u=e.user.favIconUrl,d=c(t,!1),m=n();m&&m.postMessage({type:"SavePublisherVisit",mediaType:o,data:{url:d,publisherKey:s,publisherName:a,mediaKey:l,favIconUrl:u}})}))})(e)};let f=!1,h="";const p=e=>{e&&(e.url||"complete"===e.status)&&location.href!==h&&(h=location.href,m())};var b;chrome.extension.inIncognitoContext||(b=e=>{e?(s()?m():document.addEventListener("readystatechange",(function(){s()&&m()})),document.addEventListener("visibilitychange",(function(){"visible"===document.visibilityState&&m()})),((e,t)=>{if(f)return;f=!0;const r=n();r&&(r.postMessage({type:"RegisterOnUpdatedTab",mediaType:e}),r.onMessage.addListener((function(e){e.data&&"OnUpdatedTab"===e.type&&t(e.data.changeInfo)})))})(o,p)):console.error("Failed to initialize communications port")},t?b(!0):(chrome.runtime.sendMessage(e,{type:"SupportsGreaselion"},(function(n){!chrome.runtime.lastError&&n&&n.supported&&(t=chrome.runtime.connect(e,{name:"Greaselion"}),b(!0))})),setTimeout((()=>{t||(t=chrome.runtime.connect("jidkidbbcafjabdphckchenhfomhnfma",{name:"Greaselion"}),b(!0))}),100)),console.info("Greaselion script loaded: redditBase.ts"))})();