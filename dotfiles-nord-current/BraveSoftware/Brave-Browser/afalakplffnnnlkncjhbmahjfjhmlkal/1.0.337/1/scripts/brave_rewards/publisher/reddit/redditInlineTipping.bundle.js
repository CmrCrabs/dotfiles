(()=>{"use strict";const e="mnojpmjdmbbfmejpflffifhffcmidifd";let t=null;const n=()=>t;let o=!1;const s=(e,t,n)=>{if(e.length<t.length)return"";const o=e.indexOf(t);if(-1===o)return"";const s=o+t.length,r=e.indexOf(n,s);let a="";return r!==s?a=-1!==r&&r>s||-1!==r?e.substring(s,r):e.substring(s):""===n&&(a=e.substring(s)),a},r=()=>"complete"===document.readyState&&"visible"===document.visibilityState,a="reddit",i=(e,t)=>{if(!e)return"";let n="www";return t&&(n="old"),`https://${n}.reddit.com/user/${e}/`},l=async(e,t)=>{if(!e)throw new Error("Invalid parameters");const n=i(e,t);if(!n)throw new Error("Invalid profile url");const o=await fetch(n);if(!o.ok){const e=((e,t)=>`Profile request failed: ${t.statusText} (${t.status})`)(0,o);throw new Error(e)}return o.text()},c=e=>{if(!e)return"";let t=s(e,'hideFromRobots":false,"id":"t2_','","isEmployee"')||s(e,'hideFromRobots":true,"id":"t2_','","isEmployee"');return t||(t=s(e,'target_fullname": "t2_','"')),t},d=e=>e?s(e,'accountIcon":"',"?"):"",m=e=>{if(!e)return"";let t=s(e,'username":"','"');return t||(t=s(e,'target_name": "','"')),t},u=200;let p=null;const h=()=>{const e=document.createElement("span");return e.className="IconContainer",e},f=()=>{const e=document.createElement("span");return e.className="tip-icon--medium",e.style.background="transparent",e.style.content=`url("data:image/svg+xml,${encodeURIComponent('<svg fill="inherit" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.821 11.1L8.075 6.732v-2.38l4.917 8.195-2.17-1.447zm-6.03.965h5.397l1.752 1.168H2.747l2.043-1.168zm2.13-5.333L4.187 11.08l-1.983 1.133 4.717-7.861v2.38zm.577 1.251l1.841 2.928H5.657l1.841-2.928zm7.42 5.53L7.993 1.97c-.018-.03-.043-.054-.066-.08a.568.568 0 00-.429-.2.57.57 0 00-.43.2c-.022.026-.047.05-.064.08L.079 13.513a.59.59 0 00-.061.143c-.002.004-.002.007-.002.01a.571.571 0 00-.008.237.56.56 0 00.064.193c.01.017.023.029.034.044.02.026.037.055.06.077.021.022.047.038.071.057.017.011.031.025.048.035.027.016.056.025.085.036.018.007.035.016.054.022a.597.597 0 00.132.017c.006 0 .012.003.017.003h13.85a.576.576 0 00.495-.874z" fill="#6A7684"/></svg>')}")`,e.style.height="20px",e.style.verticalAlign="middle",e.style.width="20px",e},g=e=>e?e.querySelector('button[aria-label="more options"]'):null,y=e=>{const t=e.querySelector('button[aria-label="more options"]');return t?t.nextElementSibling||t.previousElementSibling||!t.parentElement?t:t.parentElement:null},E=e=>document.evaluate(".//button[text()='Save']",e,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue,b=e=>{const t=document.evaluate(".//span[text()='save']",e,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;return t&&t.parentElement&&t.parentElement.parentElement?t.parentElement.parentElement:null},v=e=>{const t=(()=>{const e=document.createElement("li");return e.className="action-brave-tip",e})(),n=document.createElement("span");t.appendChild(n);const o=h(),s=f();o.appendChild(s);const r=(()=>{const e=document.createElement("a");return e.className="reddit-actionButton",e.href="javascript:void(0)",e.textContent=chrome.i18n.getMessage("redditTipsIconLabel"),e})();r.appendChild(o),r.onclick=function(t){return t.stopPropagation(),(async e=>{if(!e)throw new Error("Invalid parameters");let t="";const n=e.querySelector('a[data-event-action="title"]'),o=e.getElementsByClassName("md");if(o&&0!==o.length){const e=o[0];e&&e.innerText&&(t=e.innerText)}else t=n&&n.innerText?n.innerText:"";t.length>u&&(t=t.substr(0,u)+"...");let s,r="";const a=e.getElementsByClassName("entry");if(a&&(s=a[0].getElementsByClassName("author")),s&&s.length>0){const e=s[0];e&&e.textContent&&(r=e.textContent)}let i="";const p=e.getElementsByTagName("time");p&&p.length>0&&(i=p[0].textContent||"");const h=await l(r,!0);return{user:{id:c(h),screenName:r,fullName:m(h),favIconUrl:d(h)},post:{id:"",timestamp:i,text:t||""}}})(e).then((e=>{e&&S(e)}))};const a=n.attachShadow({mode:"open"});return a.appendChild(o),a.appendChild(r),a.appendChild((()=>{const e=document.createElement("style");return e.appendChild(document.createTextNode(".reddit-actionButton { color: #888; font-weight: bold; paddings: 0 1px; text-decoration: none } .reddit-actionButton:hover { text-decoration: underline }")),e})()),t},x=(e,t)=>{const n=(e=>{const t=document.createElement("div");return t.className="action-brave-tip",e&&(t.style.display="flex",t.style.alignItems="center"),t.setAttribute("data-original-title",chrome.i18n.getMessage("redditTipsHoverText")),t})(t),o=(()=>{const e=document.createElement("button");e.className="reddit-actionButton",e.style.background="transparent",e.style.border="none",e.style.borderRadius="2px",e.style.color="inherit",e.style.cursor="pointer",e.style.font="inherit",e.style.height="100%",e.style.padding="8px",e.style.width="auto",e.type="button";const t=document.createElement("style");return t.appendChild(document.createTextNode(".reddit-actionButton {}")),e.appendChild(t),e})();o.onclick=function(t){return t.stopPropagation(),(async e=>{if(!e)throw new Error("Invalid parameters");let t="",n=e.getElementsByTagName("p");if(n&&0!==n.length){const e=n[0].parentElement;e&&e.innerText&&(t=e.innerText)}else n=e.getElementsByTagName("h3"),n&&n.length>0?n[0].innerText&&(t=n[0].innerText):(n=e.getElementsByTagName("h1"),n&&n.length>0&&n[0].innerText&&(t=n[0].innerText));t.length>u&&(t=t.substr(0,u)+"...");let o="";const s=e.querySelectorAll('a[href^="/user/"]:not([data-click-id="body"]):not([data-click-id="subreddit"])');for(const e of s)if(e&&e.textContent){o=e.textContent.startsWith("u/")?e.textContent.split("/")[1]:e.textContent;break}let r="";const a=e.querySelector('a[data-click-id="timestamp"]');if(a)r=a.textContent||"";else{const t=e.querySelector('div[data-test-id="comment"]');if(t){const e=t.previousElementSibling;if(e){const t=e.getElementsByTagName("a");if(t&&t.length>1){const e=t[1].getElementsByTagName("span");e&&e.length>0&&(r=e[0].textContent||"")}}}}const i=await l(o,!1);return{user:{id:c(i),screenName:o,fullName:m(i),favIconUrl:d(i)},post:{id:"",timestamp:r,text:t||""}}})(e).then((e=>{e&&S(e)}))};const s=h();o.appendChild(s);const r=f();s.appendChild(r);const a=(()=>{const e=document.createElement("span");return e.className="reddit-actionCount",e.style.color="inherit",e.style.lineHeight="12px",e.style.margin="0",e.style.verticalAlign="middle",e})();o.appendChild(a);const i=(()=>{const e=document.createElement("span");return e.className="reddit-actionButton",e.textContent=chrome.i18n.getMessage("redditTipsIconLabel"),e})();a.appendChild(i);const p=n.attachShadow({mode:"open"});p.appendChild(o);const g=(()=>{const e=document.createElement("style");return e.appendChild(document.createTextNode(":host { outline: none } :host(:hover) { background-color: var(--newRedditTheme-navIconFaded10) }")),e})();return p.appendChild(g),n},T=(e,t,n)=>{e&&t&&n&&t.insertAdjacentElement("afterend",x(e,n.posts))},C=(e,t,n)=>{e&&t&&n&&(n.usersPost||n.posts?t.parentElement&&t.parentElement.insertAdjacentElement("beforebegin",x(e,n.posts)):t.insertAdjacentElement("beforebegin",x(e,n.posts)))},N=e=>{if(!e)return;const t=e.posts?document.getElementsByClassName("Post"):document.getElementsByClassName("Comment");var n;if(t)for(const o of t){const t=(n=o,Boolean(document.evaluate(".//button[text()='edit']",n,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue)),s=o.querySelectorAll("div.action-brave-tip"),r=o.querySelector('div[data-test-id="comment-submission-form-richtext"');if(s.length>0||r)continue;const a=e.promotedPosts?b(o):E(o);if(a)T(o,a,e);else{const n=e.posts?y(o):g(o);if(n){const s={posts:e.posts,usersPost:t};C(o,n,s)}}}},w=e=>{const t=document.querySelectorAll(`div[data-type="${e}"]`);if(t)for(const e of t){if(e.querySelectorAll("li.action-brave-tip").length>0)continue;const t=e.getElementsByClassName("flat-list");if(0===t.length)continue;const n=v(e);t[0].insertAdjacentElement("beforeend",n)}},S=e=>{const t=n();if(!t)return;const o=((e,t)=>`${e}#channel:${t}`)(a,e.user.id),s=e.user.fullName,r=e.user.screenName,l=i(e.user.screenName,!1);t.postMessage({type:"TipUser",mediaType:a,data:{url:l,publisherKey:o,publisherName:s,publisherScreenName:r,favIconUrl:e.user.favIconUrl,postId:e.post.id,postTimestamp:e.post.timestamp,postText:e.post.text}})},I=()=>{var e;clearTimeout(p),(e=new URL(location.href)).hostname.startsWith("old.")||e.hostname.startsWith("np.")?(w("comment"),w("link")):(N({posts:!1,promotedPosts:!1}),N({posts:!0,promotedPosts:!1}),N({posts:!0,promotedPosts:!0})),p=setTimeout(I,3e3)};let B="";const R=e=>{e&&(e.url||"complete"===e.status)&&location.href!==B&&(B=location.href,I())};var P;chrome.extension.inIncognitoContext||(P=e=>{e?(r()?I():document.addEventListener("readystatechange",(function(){r()&&I()})),document.addEventListener("visibilitychange",(function(){"visible"===document.visibilityState&&I()})),((e,t)=>{if(o)return;o=!0;const s=n();s&&(s.postMessage({type:"RegisterOnUpdatedTab",mediaType:e}),s.onMessage.addListener((function(e){e.data&&"OnUpdatedTab"===e.type&&t(e.data.changeInfo)})))})(a,R)):console.error("Failed to initialize communications port")},t?P(!0):(chrome.runtime.sendMessage(e,{type:"SupportsGreaselion"},(function(n){!chrome.runtime.lastError&&n&&n.supported&&(t=chrome.runtime.connect(e,{name:"Greaselion"}),P(!0))})),setTimeout((()=>{t||(t=chrome.runtime.connect("jidkidbbcafjabdphckchenhfomhnfma",{name:"Greaselion"}),P(!0))}),100)),console.info("Greaselion script loaded: redditInlineTipping.ts"))})();